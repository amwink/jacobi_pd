# helpful link:
#https://stackoverflow.com/questions/27644586/how-to-set-up-travis-ci-with-multiple-languages


matrix:
  include:

    - language: cpp
      compiler: gcc
      # Optional: "dist" specifies the operating system ("bionic"=ubuntu18.04)
      dist: bionic
      #install:
      #  - sudo apt-get install -qq cppcheck
      script:
        - cd tests
        - g++ -std=c++11 -I../include -o test_jacobi test.cpp
        # Note: With such a huge spread of eigenvalue magnitudes(1e-09..1e+09),
        # some of the smaller eigenvalues (and their corresponding eigenvectors)
        # will be calculated incorrectly due to numeric underflow.
        # The test will not fail in these cases since this is to be expected.
        # Only errors which are within machine precision of the largest
        # eigenvalues are considered important.
        #- cppcheck --quiet --error-exitcode=1
        - ./test_jacobi 2 1000 1e-09 1e+09
        - ./test_jacobi 5 1000 1e-09 1e+09
        - ./test_jacobi 20 100 1e-09 1e+09
        #- now test again with degenerate eigenvalues
        - ./test_jacobi 2 1000 1e-09 1e+09 2
        - ./test_jacobi 5 1000 1e-09 1e+09 2
        - ./test_jacobi 20 100 1e-09 1e+09 5
        #- now use valgrind to find memory leaks and other errors:
        - valgrind --leak-check=full --error-exitcode=1 ./test_jacobi 5 10 1e-09 1e+09
        - valgrind --leak-check=full --error-exitcode=1 ./test_jacobi 5 10 1e-09 1e+09 2
        - cd ../

    - language: cpp
      compiler: clang
      # Optional: "dist" specifies the operating system ("bionic"=ubuntu18.04)
      dist: bionic
      #install:
      #  - sudo apt-get install -qq cppcheck
      script:
        - cd tests
        - clang++ -std=c++11 -I../include -o test_jacobi test.cpp
        #- cppcheck --quiet --error-exitcode=1
        # Note: With such a huge spread of eigenvalue magnitudes(1e-09..1e+09),
        # some of the smaller eigenvalues (and their corresponding eigenvectors)
        # will be calculated incorrectly due to numeric underflow.
        # The test will not fail in these cases since this is to be expected.
        # Only errors which are within machine precision of the largest
        # eigenvalues are considered important.
        - ./test_jacobi 2 1000 1e-09 1e+09
        - ./test_jacobi 5 1000 1e-09 1e+09
        - ./test_jacobi 20 100 1e-09 1e+09
        #- now test again with degenerate eigenvalues
        - ./test_jacobi 2 1000 1e-09 1e+09 2
        - ./test_jacobi 5 1000 1e-09 1e+09 2
        - ./test_jacobi 20 100 1e-09 1e+09 5
        - valgrind --leak-check=full --error-exitcode=1 ./test_jacobi 5 10 1e-09 1e+09
        - valgrind --leak-check=full --error-exitcode=1 ./test_jacobi 5 10 1e-09 1e+09 2
        - cd ../

